<html>
    <head>
        <meta charset="UTF-8" />
        <script src="js/main.js"></script>
        <script src="js/GPXParser.min.js"></script>
        <script type="text/javascript">
            function load_gpx(filename) {
                const xhttp = new XMLHttpRequest();
                xhttp.open("GET", filename, false);
                xhttp.send();

                var gpx = new gpxParser(); //Create gpxParser Object
                gpx.parse(xhttp.responseText);
                return gpx;
            }

            function fill_elements() {
                // get query arguments            
                var $_GET = parse_args();

                if (!valid_get_args($_GET)) {
                    document.getElementById("title").innerHTML = "Suivi de coureur sur une trace GPX (HTML/JS only)" +
                        " : vous devez passer les arguments <code>lat</code>, <code>lon</code> et <code>track</code>";
                    return;
                }

                var url = "gpx/" + $_GET["track"] + ".gpx";

                var s_params = "<ul>"
                for ([key, value] of Object.entries($_GET)) {
                    if (key != "track") {
                        s_params += "<li>" + key + ": " + value + "</li>";
                    }
                }
                s_params += "</ul>";
                document.getElementById("params").innerHTML = s_params;

                var gpx_o = load_gpx(url);
                
                var s_tracks = "<h2>Tracks trouv√©es dans <code>" + url + "</code></h2><ul>";
                for (const track of gpx_o.tracks) {
                    s_tracks += "<li>" + track.name + ": " + Math.round(track.distance.total / 1000) + "km";
                    s_tracks += "<ul><li>Distance parcourue (optimiste): " + Math.round(distance_covered_second_half($_GET["lat"], $_GET["lon"], track) / 1000) + "km)</li>";
                    s_tracks += "<li>Distance parcourue (pessimiste): " + Math.round(distance_covered_first_half($_GET["lat"], $_GET["lon"], track) / 1000) + "km)</li></ul></li>";
                }
                s_tracks += "</ul>";
                document.getElementById("found_tracks").innerHTML = s_tracks;
            }
        </script>
    </head>
    <body onload="fill_elements()">
        <h1 id="title"></h1>

        <p id="found_tracks"></p>
    </body>
</html>