<html>
    <head>
        <meta charset="UTF-8" />
        <script src="js/main.js"></script>
        <script src="js/GPXParser.min.js"></script>
        <script type="text/javascript">
            function load_gpx(filename) {
                const xhttp = new XMLHttpRequest();
                xhttp.open("GET", filename, false);
                xhttp.send();

                var gpx = new gpxParser(); //Create gpxParser Object
                gpx.parse(xhttp.responseText);
                return gpx;
            }

            function fill_elements() {
                // get query arguments            
                var $_GET = parse_args();
                var url = "gpx/" + $_GET["track"] + ".gpx";

                document.getElementById("track").innerHTML = "Track URL: <code>" + url + "</code>";

                var s_params = "<ul>"
                for ([key, value] of Object.entries($_GET)) {
                    if (key != "track") {
                        s_params += "<li>" + key + ": " + value + "</li>";
                    }
                }
                s_params += "</ul>";
                document.getElementById("params").innerHTML = s_params;

                var gpx_o = load_gpx(url);
                
                var s_tracks = "<h2>List of tracks</h2><ul>"
                for (const track of gpx_o.tracks) {
                    s_tracks += "<li>" + track.name + ": " + (track.distance.total / 1000) + "km</li>";
                }
                s_tracks += "</ul>";
                document.getElementById("found_tracks").innerHTML = s_tracks;
            }
        </script>
    </head>
    <body onload="fill_elements()">
        <h1>Suivi de coureur sur une trace GPX (HTML/JS only)</h1>

        <p id="track"></p>
        <p id="params"></p>
        <p id="found_tracks"></p>
    </body>
</html>